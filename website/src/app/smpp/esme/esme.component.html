<div class="container-fluid">
  <h1 class="text-center">SMPP Simulator Settings</h1>
  <div class="row">
    <div class="col-md-6">
      <div class="card bg-light">
        <div class="card-body">
          <formly-form [model]="settings" [fields]="fields" [form]="form"></formly-form>
          <pre class="d-none"><code [innerHTML]="settings | json"></code></pre>
        </div>
        <div class="card-footer">
          <div class="btn-toolbar d-flex justify-content-center">
            <div class="btn-group m-2">
              <button type="submit" id="save-entity" [disabled]="form.invalid" (click)="save()" class="btn btn-primary">
                <fa-icon icon="save"></fa-icon>&nbsp;<span jhiTranslate="entity.action.save">Save</span>
              </button>
              <button type="button" (click)="startASession()" class="btn btn-success">
                <fa-icon icon="play-circle"></fa-icon>&nbsp;
                <span class="d-none d-md-inline">Start Session</span>
              </button>

              <button type="button" (click)="stopASession()" class="btn btn-warning">
                <fa-icon icon="pause-circle"></fa-icon>&nbsp;
                <span class="d-none d-md-inline">Stop Session</span>
              </button>
            </div>
            <div class="btn-group m-2">
              <button type="button" (click)="submitMessage()" class="btn btn-primary">
                <fa-icon icon="paper-plane"></fa-icon>&nbsp;
                <span class="d-none d-md-inline">Submit Message</span>
              </button>
              <button type="button" (click)="convertHex()" class="btn btn-info">
                <fa-icon icon="random"></fa-icon>&nbsp;
                <span class="d-none d-md-inline">Convert Text to Hex</span>
              </button>
            </div>
            <div class="btn-group m-2">
              <button type="button" (click)="bulkSendingRandom()" class="btn btn-warning">
                <fa-icon icon="fast-forward"></fa-icon>&nbsp;
                <span class="d-none d-md-inline">Bulk Sending Random</span>
              </button>
              <button type="button" (click)="stopBulkSending()" class="btn btn-secondary">
                <fa-icon icon="stop-circle"></fa-icon>&nbsp;
                <span class="d-none d-md-inline">Stop Bulk Sending</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <ngb-tabset justify="justified" activeId="messages">
            <ngb-tab id="messages">
              <ng-template ngbTabTitle>
                <fa-icon icon="bell" [fixedWidth]="true"></fa-icon>
                <span>Messages</span>
              </ng-template>
              <ng-template ngbTabContent>
                <h3 class="d-flex justify-content-between my-3">
                  <span>Messages</span>
                  <div class="btn-group">
                    <button type="button" (click)="refreshState()" class="btn btn-sm btn-info">
                      <fa-icon icon="sync"></fa-icon>
                      <span class="d-none d-md-inline">Refresh State</span>
                    </button>
                    <button type="button" (click)="refresh()" class="btn btn-sm btn-secondary">
                      <fa-icon icon="ban"></fa-icon>
                      <span class="d-none d-md-inline">Truncate Logs</span>
                    </button>
                  </div>
                </h3>
                <div class="alert alert-info">
                  To view message detail, click on the row.
                </div>
                <p class="text-danger border-top text-center" [innerHtml]="statusMsg"></p>

                <div class="table-responsive" style="height: 550px; overflow-y: scroll;">
                  <table class="table table-striped table-narrow">
                    <thead>
                      <tr>
                        <th>Timestamp</th>
                        <th>Message</th>
                        <th>Info</th>
                      </tr>
                    </thead>
                    <tbody *ngIf="messages">
                      <tr *ngFor="let m of messages;" (click)="m.info && viewDetail(m)">
                        <td [innerHtml]="m.timeStamp"></td>
                        <td [innerHtml]="m.msg"></td>
                        <td [innerHTML]="m.info"></td>
                      </tr>
                    </tbody>
                  </table>
                </div>

              </ng-template>
            </ngb-tab>
            <ngb-tab id="profiles">
              <ng-template ngbTabTitle>
                <fa-icon icon="briefcase" [fixedWidth]="true"></fa-icon>
                <span>Presets</span>
              </ng-template>
              <ng-template ngbTabContent>
                <h3 class="d-flex justify-content-between my-3">
                  <span>Profiles</span>
                  <button id="jh-create-entity" class="btn btn-sm btn-primary float-right" type="button" (click)="addProfile()">
                    <fa-icon icon="plus"></fa-icon>
                    <span>Save Current</span>
                  </button>
                </h3>

                <div class="alert alert-info">
                  Settings on the left panel can be save and restore from this tab.<br>
                  To add the current settings into a preset, press the <strong>Save Current</strong> button.<br>
                  To restore the settings from a preset the SMS set, press <strong>Select</strong> button.
                </div>

                <div class="table-responsive">
                  <table class="table table-striped table-narrow">
                    <thead>
                      <tr>
                        <th>System ID</th>
                        <th>Password</th>
                        <th>Type</th>
                        <th>Mode</th>
                        <th>Host</th>
                        <th>Port</th>
                        <th class="text-right"></th>
                      </tr>
                    </thead>
                    <tbody *ngIf="profiles">
                      <tr *ngFor="let p of profiles;">
                        <td [innerHTML]="p.systemId"></td>
                        <td [innerHTML]="p.password"></td>
                        <td [innerHTML]="p.smppSessionType"></td>
                        <td [innerHTML]="p.bindType"></td>
                        <td [innerHTML]="p.host"></td>
                        <td [innerHTML]="p.port"></td>
                        <td class="text-right">
                          <div class="btn-group">
                            <button type="button" class="btn btn-info btn-sm" (click)="selectProfile(p)">
                              <fa-icon icon="eye"></fa-icon>
                              <span class="d-none d-md-inline">Select</span>
                            </button>
                            <button type="button" class="btn btn-danger btn-sm" (click)="deleteProfile(p)">
                              <fa-icon icon="ban"></fa-icon>
                              <span class="d-none d-md-inline">Delete</span>
                            </button>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </ng-template>
            </ngb-tab>
            <ngb-tab id="sms-set">
              <ng-template ngbTabTitle>
                <fa-icon icon="tasks" [fixedWidth]="true"></fa-icon>
                <span>SMS Set</span>
              </ng-template>
              <ng-template ngbTabContent>
                <h3 class="d-flex justify-content-between my-3">
                  <span>Sms Set</span>
                  <div class="btn-group">
                    <button id="jh-create-entity" class="btn btn-sm btn-primary float-right" type="button" (click)="addToSet()">
                      <fa-icon icon="plus"></fa-icon>
                      <span>Add to Set</span>
                    </button>
                    <button type="button" class="btn btn-info btn-sm" (click)="sendSmsSet()">
                      <fa-icon icon="paper-plane"></fa-icon>
                      <span class="d-none d-md-inline">Send Sms Set</span>
                    </button>
                  </div>
                </h3>

                <div class="alert alert-info">
                  Multiple SMS can be submit at once at a set.<br>
                  To add the current settings into SMS Set, press the <strong>Add to Set</strong> button.<br>
                  To send the SMS set, press <strong>Send Sms Set</strong> button.
                </div>

                <div class="table-responsive">
                  <table class="table table-striped table-narrow">
                    <thead>
                      <tr>
                        <th>Source</th>
                        <th>Dest</th>
                        <th>Type</th>
                        <th>DCS</th>
                        <th>Text</th>
                        <th class="text-right">
                        </th>
                      </tr>
                    </thead>
                    <tbody *ngIf="smsSet">
                      <tr *ngFor="let s of smsSet; let idx = index;">
                        <td [innerHTML]="s.sourceAddress"></td>
                        <td [innerHTML]="s.destAddress"></td>
                        <td [innerHTML]="s.sendingMessageType"></td>
                        <td [innerHTML]="s.dcsHex"></td>
                        <td [innerHTML]="s.encodingType == 'HEX' ? s.shortMsgHex : s.messageText"></td>
                        <td class="text-right">
                          <div class="btn-group">
                            <button type="button" class="btn btn-danger btn-sm" (click)="deleteSms(idx)">
                              <fa-icon icon="ban"></fa-icon>
                              <span class="d-none d-md-inline">Delete</span>
                            </button>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </ng-template>
            </ngb-tab>
          </ngb-tabset>

        </div>
      </div>
    </div>
  </div>
</div>
<ng-template #detailModal let-modal>
  <div class="modal-header">
    <span class="badge badge-primary mr-2" [innerHtml]="modalModel.timeStamp"></span>
    <span class="badge badge-info mr-2" [innerHtml]="modalModel.msg"></span>
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" (click)="modal.dismiss()">&times;</button>
  </div>
  <div class="modal-body">
    <textarea [innerHTML]="modalModel.info" readonly="true" class="form-control bg-light" cols="80" rows="10"></textarea>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="modal.dismiss()">
      <fa-icon icon="check-circle"></fa-icon>
      <span>OK</span>
    </button>
  </div>
</ng-template>
